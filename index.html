<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>å£ç®—å°è¾¾äºº Â· ç­‰çº§è¿œå¾</title>
  <style>
    /* ----- å…¨å±€é‡ç½®ï¼Œç§»åŠ¨ç«¯ä¼˜å…ˆï¼Œæ— å¤šä½™è¾¹æ¡† ----- */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      background: linear-gradient(145deg, #1f4a3c, #17352b);
      font-family: 'Segoe UI', 'Poppins', system-ui, -apple-system, sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 12px;
    }
    /* ä¸»å®¹å™¨ï¼šå®½åº¦è‡ªé€‚åº”ï¼Œå»é™¤åšé‡è¾¹æ¡†ï¼Œæ”¹ç”¨è½»ç›ˆé˜´å½± */
    .game-box {
      max-width: 600px;
      width: 100%;
      background: #ffeacb;
      border-radius: 36px 36px 28px 28px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      padding: 18px 16px 24px;
      position: relative;
    }
    /* ----- æ ‡é¢˜ + åœ†å½¢logoï¼ˆç¼©å°é€‚é…ï¼‰----- */
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      background: #ff7b4a;
      padding: 10px 12px;
      border-radius: 50px;
      color: white;
      text-shadow: 2px 2px 0 #a8482a;
      box-shadow: 0 5px 0 #8f3d26, inset 0 1px 4px rgba(255,255,255,0.5);
      margin-bottom: 20px;
    }
    .logo-circle {
      width: 44px;
      height: 44px;
      background: radial-gradient(circle at 30% 30%, #ffee88, #ffbb33);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      font-weight: bold;
      color: #5e2e1c;
      box-shadow: 0 4px 0 #b46f3a, inset 0 -2px 0 rgba(0,0,0,0.1);
      border: 2px solid #fffbe3;
      text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
    }
    h1 {
      font-size: 1.9rem;
      letter-spacing: 4px;
      font-weight: 900;
      margin: 0;
      line-height: 1;
      white-space: nowrap;
    }
    /* ----- é¢æ¿ æ— å†—ä½™è¾¹æ¡†ï¼ŒæŸ”å’Œå†…é˜´å½±----- */
    .panel {
      background: rgba(255, 241, 184, 0.8);
      backdrop-filter: blur(2px);
      border-radius: 36px;
      padding: 20px 16px;
      box-shadow: inset 0 -2px 0 #c0a070, inset 0 1px 6px white;
    }
    #homePanel { display: block; }
    #gamePanel { display: none; }

    /* ----- é¦–é¡µç­‰çº§åŒº æ›´ç´§å‡‘ï¼Œæ–‡å­—ä¸æ¢è¡Œ----- */
    .rank-area {
      background: #f9e9c2;
      border-radius: 32px;
      padding: 18px 16px;
      margin: 0 0 18px;
      box-shadow: inset 0 0 0 2px #ffcd7e;
    }
    .your-rank-label {
      font-size: 1.2rem;
      color: #4a3720;
      font-weight: bold;
      text-align: center;
      letter-spacing: 2px;
    }
    .current-rank-big {
      font-size: 2rem;
      font-weight: 900;
      background: #ffd966;
      display: inline-block;
      padding: 6px 22px;
      border-radius: 50px;
      margin: 8px 0 12px;
      border: 3px solid #ffa42b;
      color: #362812;
      text-shadow: 1px 1px 0 #ffe69b;
      box-shadow: 0 4px 0 #b47d3a;
      white-space: nowrap;
    }
    /* ç»¿è‰²è¿›åº¦æ¡ æ›´ç»† */
    .progress-bar-bg {
      background: #5d4a34;
      height: 18px;
      border-radius: 20px;
      margin: 6px 0 4px;
      border: 2px solid #3d2e1f;
      overflow: hidden;
    }
    .progress-fill {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #3cac3c, #76d276);
      box-shadow: 0 0 8px #8bc34a;
      border-radius: 20px;
    }
    .rank-stats-row {
      display: flex;
      justify-content: space-between;
      font-size: 1.1rem;
      font-weight: bold;
      margin-top: 8px;
      white-space: nowrap;
    }
    /* ----- åšé¢˜ç•Œé¢ ç´¯è®¡é¢˜æ ‡ ----- */
    .stats-banner {
      display: flex;
      justify-content: flex-end;
      background: #a56b3b;
      padding: 6px 16px;
      border-radius: 40px;
      color: white;
      margin-bottom: 14px;
      font-size: 1.2rem;
      font-weight: bold;
      box-shadow: inset 0 -2px 0 #6d4526;
      white-space: nowrap;
    }
    /* ----- è¡€æ¡å€’è®¡æ—¶ ç´§å‡‘----- */
    .blood-bar-container {
      background: #4b2f1c;
      padding: 5px;
      border-radius: 20px;
      margin: 6px 0 14px;
    }
    .blood-track {
      height: 20px;
      background: #471e1e;
      border-radius: 16px;
      overflow: hidden;
    }
    .blood-fill {
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, #eb4d4b, #ff7979);
      border-radius: 16px;
      transition: width 0.2s linear;
    }
    .timer-text {
      text-align: right;
      font-size: 1.1rem;
      color: white;
      font-weight: bold;
      margin-top: 2px;
      text-shadow: 1px 1px 0 #3a2a1a;
    }
    /* ----- é¢˜ç›®åŒºåŸŸ æ— å¤šä½™è¾¹æ¡†ï¼Œå­—ä½“é€‚é…----- */
    .question-area {
      background: #e6d5b8;
      padding: 16px 12px;
      border-radius: 40px 16px 40px 16px;
      margin: 6px 0 14px;
    }
    .equation {
      font-size: 2.8rem;
      font-weight: 900;
      text-align: center;
      background: white;
      padding: 8px;
      border-radius: 40px;
      color: #2d1e0b;
      font-family: 'Courier New', monospace;
      white-space: nowrap;
      box-shadow: inset 0 0 0 2px #a1784a;
    }
    .answer-input-area {
      background: #afc7b0;
      margin-top: 12px;
      padding: 8px;
      border-radius: 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .current-answer {
      background: white;
      padding: 8px 18px;
      border-radius: 40px;
      font-size: 1.8rem;
      font-weight: bold;
      min-width: 90px;
      text-align: center;
      border: 3px solid #6b8c6b;
      white-space: nowrap;
    }
    .feedback-badge {
      font-size: 1.4rem;
      background: #f3e1b0;
      padding: 6px 16px;
      border-radius: 40px;
      border: 2px solid;
      white-space: nowrap;
    }
    /* ----- æ•°å­—é”®ç›˜ è‡ªé€‚åº”ç½‘æ ¼ï¼Œä¸å˜å½¢----- */
    .num-pad {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin: 16px 0 12px;
    }
    .num-btn {
      aspect-ratio: 1 / 1;
      width: 100%;
      background: #fdea9c;
      border-radius: 50%;
      border: 4px solid #ff934f;
      font-size: 2rem;
      font-weight: bold;
      color: #2b2b2b;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 0 #b2633a, 0 5px 10px rgba(0,0,0,0.2);
      transition: 0.02s;
    }
    .num-btn:active {
      transform: translateY(6px);
      box-shadow: 0 1px 0 #b2633a, 0 5px 10px black;
    }
    /* ç§»é™¤å¤šä½™çš„è¡ŒåŒ…è£…ï¼Œç›´æ¥ç”¨grid */
    .row-buttons { display: contents; } /* ä¿ç•™åŸæœ‰ç»“æ„ä½†æ— å¸ƒå±€å½±å“ */

    /* ----- æ“ä½œæŒ‰é’® ç­‰å®½ç­‰é«˜ï¼Œä¸å˜å½¢ ----- */
    .action-row {
      display: flex;
      gap: 14px;
      margin-top: 12px;
    }
    .action-btn {
      flex: 1;
      background: #5fa8d3;
      border: 4px solid #caff8a;
      font-size: 1.5rem;
      padding: 12px 6px;
      border-radius: 50px;
      color: white;
      text-shadow: 1px 1px 0 #1e415e;
      border-bottom: 7px solid #275b6b;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 5px 0 #1f4452;
      transition: 0.04s;
      white-space: nowrap;
    }
    .action-btn:active {
      transform: translateY(6px);
      box-shadow: 0 1px 0 #1f4452;
      border-bottom-width: 3px;
    }
    .return-home {
      background: #a7c7e7;
      border-bottom: 7px solid #5f7a9e;
      box-shadow: 0 5px 0 #364759;
      color: #1e2f47;
      text-shadow: 1px 1px 0 #bdd4ff;
      border-color: #fef9c3;
    }
    .disabled-interaction .num-btn,
    .disabled-interaction .action-btn {
      opacity: 0.5;
      pointer-events: none;
    }
    /* ç¡®ä¿æ‰€æœ‰æ–‡å­—åœ¨æç«¯å°å±ä¸‹ä¸æ¢è¡Œ */
    .current-rank-big,
    .rank-stats-row span,
    .stats-banner span,
    .equation,
    .current-answer,
    .feedback-badge,
    .action-btn {
      white-space: nowrap;
    }
    /* è°ƒæ•´å°å±ä¸‹å­—ä½“è¿›ä¸€æ­¥ç¼©å° */
    @media (max-width: 380px) {
      h1 { font-size: 1.6rem; }
      .logo-circle { width: 38px; height: 38px; font-size: 1.5rem; }
      .current-rank-big { font-size: 1.7rem; padding: 5px 16px; }
      .equation { font-size: 2.4rem; }
      .num-btn { font-size: 1.8rem; }
      .action-btn { font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <div class="game-box">
    <!-- æ ‡é¢˜åŒºåŸŸï¼šåœ†å½¢è‡ªå®šä¹‰logoï¼Œå·²ç¼©å° -->
    <div class="header">
      <div class="logo-circle">âš¡</div>
      <h1>å£ç®—å°è¾¾äºº</h1>
      <div class="logo-circle">ğŸ†</div>
    </div>

    <!-- ========= é¦–é¡µé¢æ¿ï¼šç­‰çº§å±•ç¤º + å¼€å§‹åšé¢˜ ========= -->
    <div id="homePanel" class="panel">
      <div class="rank-area">
        <div class="your-rank-label">âœ¨ ä½ çš„ç­‰çº§ âœ¨</div>
        <div style="text-align: center;">
          <span id="currentRankName" class="current-rank-big">å£ç®—æ˜Ÿæ˜Ÿ</span>
        </div>
        <div class="progress-bar-bg">
          <div id="rankProgressFill" class="progress-fill" style="width:0%;"></div>
        </div>
        <div class="rank-stats-row">
          <span id="totalCorrectLeft">ç´¯è®¡ç­”å¯¹: 0é¢˜</span>
          <span id="nextRankHint">è¿˜éœ€50é¢˜å‡è‡³å£ç®—å°å°†</span>
        </div>
      </div>
      <button id="startGameBtn" class="action-btn" style="background:#ff8a5c; border-bottom-color:#b85f2e; border-color:#ffeaa5; margin-top:4px;">ğŸš€ å¼€å§‹åšé¢˜ ğŸš€</button>
    </div>

    <!-- ========= æ¸¸æˆé¢æ¿ ========= -->
    <div id="gamePanel" class="panel">
      <div class="stats-banner">
        <span>ğŸ… åšå¯¹: <span id="gameCorrectCount">0</span> é¢˜</span>
      </div>

      <div class="blood-bar-container">
        <div class="blood-track">
          <div id="bloodFill" class="blood-fill" style="width:100%;"></div>
        </div>
        <div id="timerLabel" class="timer-text">â³ 10ç§’</div>
      </div>

      <div class="question-area">
        <div id="questionText" class="equation">5 + 3 = ?</div>
        <div class="answer-input-area">
          <span id="currentInputDisplay" class="current-answer">___</span>
          <span id="feedbackMsg" class="feedback-badge">âœ¨</span>
        </div>
      </div>

      <!-- æ•°å­—é”®ç›˜ 0-9ï¼Œgridè‡ªé€‚åº”ï¼Œå®Œå…¨ä¸å˜å½¢ -->
      <div class="num-pad">
        <button class="num-btn" data-num="1">1</button>
        <button class="num-btn" data-num="2">2</button>
        <button class="num-btn" data-num="3">3</button>
        <button class="num-btn" data-num="4">4</button>
        <button class="num-btn" data-num="5">5</button>
        <button class="num-btn" data-num="6">6</button>
        <button class="num-btn" data-num="7">7</button>
        <button class="num-btn" data-num="8">8</button>
        <button class="num-btn" data-num="9">9</button>
        <button class="num-btn" data-num="0">0</button>
      </div>

      <div class="action-row">
        <button id="submitAnswerBtn" class="action-btn">âœ… ç¡®å®š</button>
        <button id="returnHomeBtn" class="action-btn return-home">ğŸ  è¿”å›</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      "use strict";

      // ---------- éŸ³é¢‘å¼•æ“ (ä¸ä¹‹å‰å®Œå…¨ç›¸åŒ) ----------
      let audioCtx = null;
      function initAudio() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        return audioCtx;
      }
      function playClick() { playTone('click'); }
      function playCorrect() { playTone('correct'); }
      function playWrong() { playTone('wrong'); }
      function playTone(type) {
        const ctx = initAudio();
        const resume = () => {
          if (ctx.state === 'suspended') ctx.resume().then(() => actuallyPlay(type));
          else actuallyPlay(type);
        };
        resume();
      }
      function actuallyPlay(type) {
        const ctx = audioCtx;
        if (!ctx) return;
        const now = ctx.currentTime;
        const gain = ctx.createGain();
        gain.connect(ctx.destination);
        gain.gain.setValueAtTime(0.15, now);
        if (type === 'click') {
          const osc = ctx.createOscillator();
          osc.type = 'sine';
          osc.frequency.value = 650;
          osc.connect(gain);
          osc.start(now);
          osc.stop(now + 0.07);
        } else if (type === 'correct') {
          const osc = ctx.createOscillator();
          osc.type = 'triangle';
          osc.frequency.setValueAtTime(784, now);
          osc.frequency.setValueAtTime(988, now + 0.1);
          osc.connect(gain);
          osc.start(now);
          osc.stop(now + 0.2);
        } else if (type === 'wrong') {
          const osc = ctx.createOscillator();
          osc.type = 'sawtooth';
          osc.frequency.value = 200;
          osc.connect(gain);
          osc.start(now);
          osc.stop(now + 0.15);
          gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);
        }
      }

      // ---------- å…¨å±€çŠ¶æ€ ----------
      let totalCorrect = 0;           // ç´¯è®¡åšå¯¹é¢˜æ•°ï¼ˆæŒä¹…åŒ–ï¼‰
      let currentQuestion = null;
      let currentInput = '';
      let canInteract = true;
      let timerInterval = null;
      let timeoutId = null;
      let timeLeft = 10;

      let questionHistory = [];       
      const HISTORY_MAX = 20;

      const RANK_TITLES = [
        "å£ç®—æ˜Ÿæ˜Ÿ", "å£ç®—å°å°†", "å£ç®—å‹‡å£«", "å£ç®—å…ˆé”‹", 
        "å£ç®—å¤§å¸ˆ", "å£ç®—ç‹è€…", "å£ç®—æˆ˜ç¥", "å£ç®—è‡³å°Š", "å£ç®—ä¹‹ç¥"
      ];
      const STEP = 50;

      // ---------- DOM å…ƒç´  ----------
      const homePanel = document.getElementById('homePanel');
      const gamePanel = document.getElementById('gamePanel');
      const startBtn = document.getElementById('startGameBtn');
      const returnHomeBtn = document.getElementById('returnHomeBtn');
      const submitBtn = document.getElementById('submitAnswerBtn');
      const questionText = document.getElementById('questionText');
      const currentInputDisplay = document.getElementById('currentInputDisplay');
      const feedbackMsg = document.getElementById('feedbackMsg');
      const bloodFill = document.getElementById('bloodFill');
      const timerLabel = document.getElementById('timerLabel');
      const currentRankName = document.getElementById('currentRankName');
      const rankProgressFill = document.getElementById('rankProgressFill');
      const totalCorrectLeft = document.getElementById('totalCorrectLeft');
      const nextRankHint = document.getElementById('nextRankHint');
      const gameCorrectCount = document.getElementById('gameCorrectCount');

      // ---------- è¾…åŠ©å‡½æ•° ----------
      function updateInputDisplay() {
        currentInputDisplay.textContent = currentInput === '' ? '___' : currentInput;
      }
      function clearInput() { currentInput = ''; updateInputDisplay(); }

      function computeRankIndex(correct) {
        let idx = Math.floor(correct / STEP);
        return Math.min(idx, RANK_TITLES.length - 1);
      }
      function updateHomeRankDisplay() {
        const correct = totalCorrect;
        const currentIdx = computeRankIndex(correct);
        const nextIdx = Math.min(currentIdx + 1, RANK_TITLES.length - 1);
        currentRankName.textContent = RANK_TITLES[currentIdx];
        const progressed = correct % STEP;
        const percent = (progressed / STEP) * 100;
        rankProgressFill.style.width = percent + '%';
        totalCorrectLeft.textContent = `ç´¯è®¡ç­”å¯¹: ${correct}é¢˜`;
        if (currentIdx === RANK_TITLES.length - 1) {
          nextRankHint.textContent = 'ğŸ† å·²è‡»åŒ–å¢ƒ';
        } else {
          const need = STEP - progressed;
          nextRankHint.textContent = `è¿˜éœ€${need}é¢˜å‡è‡³${RANK_TITLES[nextIdx]}`;
        }
      }
      function updateGameCorrectDisplay() {
        gameCorrectCount.textContent = totalCorrect;
      }

      // ---------- é¢˜ç›®ç”Ÿæˆå™¨ï¼ˆ2:5:3æ¯”ä¾‹ï¼Œ20ä»¥å†…ç»“æœ>10ï¼Œå¸¦é‡å¤æ§åˆ¶ï¼‰---------
      function generateQuestion() {
        let rand = Math.random();
        let type;
        if (rand < 0.2) type = '10';
        else if (rand < 0.7) type = '20';
        else type = 'muldiv';

        let q = null;
        let attempts = 0;
        const MAX_ATTEMPTS = 100;
        while (!q && attempts < MAX_ATTEMPTS) {
          attempts++;
          if (type === '10') {
            if (Math.random() < 0.5) {
              let a = Math.floor(Math.random() * 11);
              let b = Math.floor(Math.random() * (11 - a));
              q = { text: `${a} + ${b} = ?`, answer: a + b, starValue: 1, op: '+', a, b };
            } else {
              let a = Math.floor(Math.random() * 11);
              let b = Math.floor(Math.random() * (a + 1));
              q = { text: `${a} - ${b} = ?`, answer: a - b, starValue: 1, op: '-', a, b };
            }
          } else if (type === '20') {
            if (Math.random() < 0.5) {
              let sum = Math.floor(Math.random() * 10) + 11;
              let a = Math.floor(Math.random() * (sum + 1));
              let b = sum - a;
              if (a <= 20 && b <= 20 && a >=0 && b>=0) {
                q = { text: `${a} + ${b} = ?`, answer: sum, starValue: 2, op: '+', a, b };
              }
            } else {
              let diff = Math.floor(Math.random() * 10) + 11;
              let b = Math.floor(Math.random() * (20 - diff + 1)); 
              let a = diff + b;
              if (a <= 20 && a >= diff) {
                q = { text: `${a} - ${b} = ?`, answer: diff, starValue: 2, op: '-', a, b };
              }
            }
          } else if (type === 'muldiv') {
            if (Math.random() < 0.5) {
              let a = Math.floor(Math.random() * 9) + 1;
              let b = Math.floor(Math.random() * 9) + 1;
              q = { text: `${a} Ã— ${b} = ?`, answer: a * b, starValue: 2, op: 'Ã—', a, b };
            } else {
              let divisor = Math.floor(Math.random() * 9) + 1;
              let quotient = Math.floor(Math.random() * 9) + 1;
              let dividend = divisor * quotient;
              q = { text: `${dividend} Ã· ${divisor} = ?`, answer: quotient, starValue: 2, op: 'Ã·', a: dividend, b: divisor };
            }
          }
          if (q && questionHistory.includes(q.text)) q = null;
        }
        if (!q) {
          if (type === '10') q = { text: `5 + 3 = ?`, answer: 8, starValue: 1, op: '+', a:5, b:3 };
          else if (type === '20') q = { text: `12 + 5 = ?`, answer: 17, starValue: 2, op: '+', a:12, b:5 };
          else q = { text: `6 Ã— 7 = ?`, answer: 42, starValue: 2, op: 'Ã—', a:6, b:7 };
        }
        questionHistory.push(q.text);
        if (questionHistory.length > HISTORY_MAX) questionHistory.shift();
        return q;
      }

      // ---------- å€’è®¡æ—¶ç®¡ç† ----------
      function stopTimer() { if (timerInterval) clearInterval(timerInterval); timerInterval = null; }
      function updateBloodAndTimer() {
        bloodFill.style.width = `${(timeLeft / 10) * 100}%`;
        timerLabel.textContent = `â³ ${timeLeft}ç§’`;
      }
      function startTimer() {
        stopTimer();
        timerInterval = setInterval(() => {
          if (!canInteract) return;
          timeLeft -= 1;
          if (timeLeft <= 0) {
            timeLeft = 0; updateBloodAndTimer();
            if (canInteract) {
              playWrong();
              feedbackMsg.textContent = 'â° è¶…æ—¶';
              feedbackMsg.style.background = '#ffb4a2';
              canInteract = false;
              gamePanel.classList.add('disabled-interaction');
              stopTimer();
              timeoutId = setTimeout(() => { loadNextQuestion(); }, 600);
            }
          } else updateBloodAndTimer();
        }, 1000);
      }

      function loadNextQuestion() {
        stopTimer();
        if (timeoutId) clearTimeout(timeoutId);
        currentQuestion = generateQuestion();
        questionText.textContent = currentQuestion.text;
        clearInput();
        feedbackMsg.textContent = 'âœ¨';
        feedbackMsg.style.background = '#f3e1b0';
        canInteract = true;
        gamePanel.classList.remove('disabled-interaction');
        timeLeft = 10;
        updateBloodAndTimer();
        startTimer();
      }

      function handleSubmit() {
        if (!canInteract || !currentQuestion) return;
        playClick();
        stopTimer();
        canInteract = false;
        gamePanel.classList.add('disabled-interaction');
        const userAns = currentInput.trim() === '' ? null : parseInt(currentInput, 10);
        const isCorrect = (userAns === currentQuestion.answer);
        if (isCorrect) {
          totalCorrect += 1;
          localStorage.setItem('totalCorrect', totalCorrect);
          updateHomeRankDisplay();
          updateGameCorrectDisplay();
          feedbackMsg.textContent = `âœ… æ­£ç¡®!`;
          feedbackMsg.style.background = '#b7e3b0';
          playCorrect();
        } else {
          feedbackMsg.textContent = 'âŒ é”™è¯¯';
          feedbackMsg.style.background = '#ffb0a0';
          playWrong();
        }
        if (timeoutId) clearTimeout(timeoutId);
        timeoutId = setTimeout(() => { loadNextQuestion(); }, 800);
      }

      function resetGameSession() {
        questionHistory = [];
        canInteract = true;
        gamePanel.classList.remove('disabled-interaction');
        updateGameCorrectDisplay();
      }

      function startGame() {
        playClick();
        resetGameSession();     
        homePanel.style.display = 'none';
        gamePanel.style.display = 'block';
        loadNextQuestion();
      }

      function goHome() {
        playClick();
        stopTimer();
        if (timeoutId) clearTimeout(timeoutId);
        gamePanel.style.display = 'none';
        homePanel.style.display = 'block';
        updateHomeRankDisplay();
        canInteract = false;
      }

      // é”®ç›˜åˆ é™¤
      function handleKeyDown(e) {
        if (gamePanel.style.display === 'block' && canInteract) {
          if (e.key === 'Backspace' || e.key === 'Delete') {
            e.preventDefault();
            if (currentInput.length > 0) {
              currentInput = currentInput.slice(0, -1);
              updateInputDisplay();
            }
          }
        }
      }
      window.addEventListener('keydown', handleKeyDown);

      // ç»‘å®šäº‹ä»¶
      startBtn.addEventListener('click', startGame);
      returnHomeBtn.addEventListener('click', goHome);
      submitBtn.addEventListener('click', handleSubmit);
      document.querySelectorAll('.num-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          playClick();
          if (!canInteract) return;
          const digit = btn.dataset.num;
          if (currentInput.length < 2) currentInput += digit;
          else currentInput = digit;
          updateInputDisplay();
        });
      });

      // åˆå§‹åŒ–ï¼šè¯»å–localStorage
      window.onload = function() {
        const saved = localStorage.getItem('totalCorrect');
        totalCorrect = saved !== null ? parseInt(saved, 10) : 0;
        updateHomeRankDisplay();
        updateGameCorrectDisplay();
        currentQuestion = generateQuestion();
        clearInput();
      };
    })();
  </script>
</body>
</html>